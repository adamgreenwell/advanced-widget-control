"use strict";var widgetcontrolSettingsModule={init:function(){jQuery(".widgetcontrol-module-settings-container").hide(),this.bindEvents()},bindEvents:function(){var e=jQuery("#wpcontent");e.on("click",".widgetcontrol-toggle-settings, .widgetcontrol-module-settings-cancel",this.openModal),e.on("click",".widgetcontrol-close-modal, .widgetcontrol-modal-background",this.closeModal),e.on("keyup",this.closeModal),e.on("click",".widgetcontrol-toggle-activation",this.moduleToggle),e.on("click",".widgetcontrol-module-settings-save",this.saveSettings),e.on("click",".opts-add-class-btn",this.toggleCustomClass),e.on("click",".opts-remove-class-btn",this.removeCustomClass),e.on("click",".widgetcontrol-delete-cache",this.clearWidgetCache),e.on("click",".widgetcontrol-license_deactivate",this.deactivationHandler)},openModal:function(e){e.preventDefault();var t=jQuery(this).parents(".widgetcontrol-module-card").find(".widgetcontrol-module-settings-container");jQuery(".widgetcontrol-modal-background").show(),t.show(),jQuery("body").addClass("widgetcontrol-modal-open")},closeModal:function(e){void 0!==e&&(e.preventDefault(),"keyup"===e.type&&27!==e.which)||(jQuery(".widgetcontrol-modal-background").hide(),jQuery(".widgetcontrol-module-settings-container").hide(),jQuery("body").removeClass("widgetcontrol-modal-open"))},moduleToggle:function(e){e.preventDefault(),e.stopPropagation();var t=jQuery(this),s=t.parents(".widgetcontrol-module-card"),a=s.find(".widgetcontrol-toggle-activation"),o=s.attr("data-module-id");if(a.prop("disabled",!0),t.html()==widgetcontrol.translation.activate)var i="activate";else var i="deactivate";widgetcontrolSettingsModule.ajaxRequest(o,i,{},widgetcontrolSettingsModule.moduleCallback)},moduleCallback:function(e){var t=e.module,s=e.method,a=jQuery("#widgetcontrol-module-card-"+t),o=a.find(".widgetcontrol-toggle-activation");if(e.errors.length>0)return o.html(widgetcontrol.translations.error).addClass("button-secondary").removeClass("button-primary"),void setTimeout(function(){widgetcontrolSettingsModule.isModuleActive(t)},1e3);if("activate"===s){if(o.html(widgetcontrol.translation.deactivate).addClass("button-secondary").removeClass("button-primary").prop("disabled",!1),a.addClass("widgetcontrol-module-type-enabled").removeClass("widgetcontrol-module-type-disabled"),a.hasClass("no-settings"))var i=widgetcontrol.translation.show_description;else var i=widgetcontrol.translation.show_settings}else{o.html(widgetcontrol.translation.activate).addClass("button-primary").removeClass("button-secondary").prop("disabled",!1),a.addClass("widgetcontrol-module-type-disabled").removeClass("widgetcontrol-module-type-enabled");var i=widgetcontrol.translation.show_description}a.find(".widgetcontrol-toggle-settings").html(i)},saveSettings:function(e){e.preventDefault();var t=jQuery(this);if(t.hasClass("widgetcontrol-module-settings-save"))var s=t.parents(".widgetcontrol-module-card").attr("data-module-id");else var s="";t.prop("disabled",!0);var a={"--widgetcontrol-form-serialized-data":jQuery("#widgetcontrol-module-settings-form").serialize()};widgetcontrolSettingsModule.ajaxRequest(s,"save",a,widgetcontrolSettingsModule.savingCallback)},savingCallback:function(e){""===e.module?jQuery("#widgetcontrol-save").prop("disabled",!1):jQuery("#widgetcontrol-module-card-"+e.module+" button.widgetcontrol-module-settings-save").prop("disabled",!1);var t=jQuery(".widgetcontrol-module-cards-container");widgetcontrolSettingsModule.clearMessages(),e.errors.length>0||!e.closeModal?(widgetcontrolSettingsModule.showMessages(e.messages,e.module,"open"),t.find(".widgetcontrol-module-settings-content-container:visible").animate({scrollTop:0},"fast")):(widgetcontrolSettingsModule.showMessages(e.messages,e.module,"closed"),t.find(".widgetcontrol-module-settings-content-container:visible").scrollTop(0),widgetcontrolSettingsModule.closeModal())},clearMessages:function(){jQuery("#widgetcontrol-settings-messages-container, .widgetcontrol-module-messages-container").empty()},showMessages:function(e,t,s){jQuery.each(e,function(e,a){widgetcontrolSettingsModule.showMessage(a,t,s)})},showMessage:function(e,t,s){if("closed"!==s&&"open"!==s&&(s="closed"),"string"!=typeof t&&(t=""),"closed"===s||""===t){var a=jQuery("#widgetcontrol-settings-messages-container");setTimeout(function(){a.removeClass("visible"),setTimeout(function(){a.find("div").remove()},500)},4e3)}else var a=jQuery("#widgetcontrol-module-card-"+t+" .widgetcontrol-module-messages-container");a.append('<div class="updated fade"><p><strong>'+e+"</strong></p></div>").addClass("visible")},ajaxRequest:function(e,t,s,a){var o={action:widgetcontrol.ajax_action,nonce:widgetcontrol.ajax_nonce,module:e,method:t,data:s};jQuery.post(ajaxurl,o).always(function(o,i,d){widgetcontrolSettingsModule.processAjaxResponse(o,i,d,e,t,s,a)})},processAjaxResponse:function(e,t,s,a,o,i,d){var n={module:a,method:o,data:i,status:t,license_status:null,jqxhr:null,success:!1,response:null,button:null,errors:[],messages:[],functionCalls:[],redirect:!1,closeModal:!0};"WIDGETCONTROL_Response"===(e=jQuery.parseJSON(e)).source&&"undefined"!==e.response&&(n.jqxhr=s,n.success=e.success,n.response=e.response,n.errors=e.errors,n.messages=e.messages,n.functionCalls=e.functionCalls,n.redirect=e.redirect,n.closeModal=e.closeModal,n.button=e.button,void 0!==n.license_status&&(n.license_status=e.license_status)),"function"==typeof d?d(n):"function"==typeof console.log&&console.log("ERROR: Unable to handle settings AJAX request due to an invalid callback:",d,{data:postData,results:n})},toggleCustomClass:function(e){var t=jQuery(".opts-add-class-txtfld").val(),s="extwopts_class_settings[classlists][]";jQuery(this).hasClass("widgetcontrol-add-class-btn")&&(s="classes[classlists][]"),t.length>0&&(jQuery("#opts-predefined-classes ul").append('<li><input type="hidden" name="'+s+'" value="'+t+'" /><span class"opts-li-value">'+t+'</span> <a href="#" class="opts-remove-class-btn"><span class="dashicons dashicons-dismiss"></span></a></li>'),jQuery(".opts-add-class-txtfld").val("")),e.preventDefault(),e.stopPropagation()},removeCustomClass:function(e){jQuery(this).parent("li").fadeOut("fast",function(){jQuery(this).remove()}),e.preventDefault(),e.stopPropagation()},clearWidgetCache:function(e){return jQuery(this).prop("disabled",!0),widgetcontrolSettingsModule.ajaxRequest("clear_cache","clear_cache","",widgetcontrolSettingsModule.clearWidgetCacheCallback),!1},clearWidgetCacheCallback:function(e){void 0!==e.response&&(jQuery(".widgetcontrol-delete-cache").after('<span class="dashicons dashicons-yes widgetcontrol-cache-dashicons"></span>'),jQuery(".widgetcontrol-cache-dashicons").delay(2e3).fadeOut(400),jQuery(".widgetcontrol-delete-cache").prop("disabled",!1))},deactivationHandler:function(e){e.preventDefault();var t,s=jQuery(this);if(s.prop("disabled",!0),""!=(t=jQuery("#"+s.attr("data-target"))).val()){var a={"license-data":t.val(),"license-action":"deactivate",shortname:s.attr("data-shortname"),button:s.attr("id")};widgetcontrolSettingsModule.ajaxRequest("license_key","deactivate_license",a,widgetcontrolSettingsModule.licenseDeactivationCallback)}else t.css({border:"1px solid red"}),s.prop("disabled",!1)},licenseDeactivationCallback:function(e){if(void 0!==e.response&&void 0!==e.messages&&void 0!==e.button){var t=jQuery("#"+e.button);jQuery("#"+t.attr("data-target")).before("<span>"+e.messages[0]+"</span>"),"deactivated"==e.success&&(t.parent("td").parent("tr").fadeOut(),jQuery("#"+t.attr("data-target")).val(""))}t.prop("disabled",!1)}};jQuery(document).ready(function(){widgetcontrolSettingsModule.init()});